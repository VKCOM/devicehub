import os from 'os'
import processor from '../../units/processor/index.js'
export const command = 'processor [name]'
export const describe = 'Start a processor unit.'
export const builder = function(yargs) {
    return yargs
        .env('STF_PROCESSOR')
        .strict()
        .option('connect-app-dealer', {
            alias: 'a',
            describe: 'App-side ZeroMQ DEALER endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('connect-dev-dealer', {
            alias: 'd',
            describe: 'Device-side ZeroMQ DEALER endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('connect-push', {
            alias: 'c',
            describe: 'App-side ZeroMQ PULL endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('connect-push-dev', {
            alias: 'pd',
            describe: 'Device-side ZeroMQ PULL endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('connect-sub', {
            alias: 'u',
            describe: 'App-side ZeroMQ PUB endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('connect-sub-dev', {
            alias: 'sd',
            describe: 'Device-side ZeroMQ PUB endpoint to connect to.',
            array: true,
            demand: true
        })
        .option('name', {
            describe: 'An easily identifiable name for log output.',
            type: 'string',
            default: os.hostname()
        })
        .option('public-ip', {
            alias: 'pi',
            description: 'Defined public ip for stf',
            type: 'string',
            default: 'localhost'
        })
        .epilog('Each option can be be overwritten with an environment variable ' +
        'by converting the option to uppercase, replacing dashes with ' +
        'underscores and prefixing it with `STF_PROCESSOR_` (e.g. ' +
        '`STF_PROCESSOR_CONNECT_APP_DEALER`).')
}
export const handler = function(argv) {
    return processor({
        name: argv.name,
        endpoints: {
            appDealer: argv.connectAppDealer,
            devDealer: argv.connectDevDealer,
            push: argv.connectPush,
            pushdev: argv.connectPushDev,
            sub: argv.connectSub,
            subdev: argv.connectSubDev
        },
        publicIp: argv.publicIp
    })
}
